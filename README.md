# 🌈 RainBow - 虹の出現を通知するアプリ

虹の出るタイミングを通知するWebアプリケーション

---

## 📝 概要

RainBowは、ユーザーの位置情報と気象データを利用して、虹が出る可能性が高いタイミングを自動検知し、プッシュ通知でお知らせするアプリケーションです。

---

## 🎯 制作背景

**【きっかけ】**  
自宅での学習中に、どんよりした天気のあと、ふと外を見ると虹がかかっていて感動したため。

**【決定打】**  
「虹 アプリ」でネット検索をかけると、ほぼ虹を加工で付け加えるアプリ機能ばかりヒットする。実物を見る機会が限られているものだからこそ、それを見ることが出来る一助になればと考えた。

---

## ✨ 主な機能

- 📍 **位置情報の自動取得**: ユーザーの現在地を取得し、その地点の天気情報を監視
- 🌤️ **リアルタイム天気監視**: OpenWeatherMap APIを使用して現在の天気情報を取得
- 🌈 **虹出現条件の判定**: 以下の条件を総合的に判定
  - 現在晴れている（またはわずかな曇り）
  - 湿度が高い（70%以上）または最近雨が降った
  - 朝日の後2時間以内、または夕日の前2時間以内（太陽の角度が適切）
- 🔔 **プッシュ通知**: 虹が見える可能性が高い時に自動で通知
- 🔄 **定期チェック**: 15分ごとに天気情報を自動で確認

---

## 🛠️ 技術スタック

- **バックエンド**: Ruby on Rails 6.0+
- **フロントエンド**: JavaScript (Vanilla JS)
- **外部API**: OpenWeatherMap API
- **プッシュ通知**: Push.js
- **HTTPクライアント**: HTTParty

---

## 🚀 セットアップ手順

### 1. リポジトリのクローン

```bash
git clone https://github.com/AirLabJP/rain-bow.git
cd rain-bow
```

### 2. 依存関係のインストール

```bash
# Ruby gemのインストール
bundle install

# Node.js パッケージのインストール
yarn install
```

### 3. OpenWeatherMap APIキーの取得

1. [OpenWeatherMap](https://openweathermap.org/)にアクセス
2. アカウント作成（無料）
3. API Keysページから無料APIキーを取得

### 4. 環境変数の設定

**重要**: APIキーを環境変数に設定してください。

```bash
# .envファイルを作成（.env.exampleがある場合はコピー）
cp .env.example .env

# .envファイルに以下を記述
echo "OPEN_WEATHER_MAP_API_KEY=your_api_key_here" > .env
```

または、以下のいずれかの方法で設定：

```bash
# macOS/Linuxの場合（~/.zshrcまたは~/.bashrcに追加）
export OPEN_WEATHER_MAP_API_KEY="your_api_key_here"

# Windowsの場合（PowerShell）
$env:OPEN_WEATHER_MAP_API_KEY="your_api_key_here"
```

### 5. データベースのセットアップ

```bash
rails db:create
rails db:migrate
```

### 6. アプリケーションの起動

```bash
rails server
```

ブラウザで `http://localhost:3000` にアクセス

---

## 💻 使い方

1. **位置情報の許可**
   - ブラウザから位置情報へのアクセスを許可してください
   - 現在地の天気情報を取得するために必要です

2. **通知の有効化**
   - 「🔔 通知を有効にする」ボタンをクリック
   - ブラウザの通知を許可してください

3. **自動監視**
   - アプリが15分ごとに自動で天気情報をチェックします
   - 虹が出る条件が揃ったら通知が届きます

4. **手動チェック**
   - 「📍 現在地の再取得」ボタンで手動更新
   - 「🧪 通知テスト」ボタンで通知の動作確認

---

## 🌈 虹が見える条件について

本アプリは以下の気象条件を組み合わせて虹の出現可能性を判定しています：

1. **現在の天候**: 晴れまたはわずかな曇り
2. **湿度**: 70%以上（空気中に水滴が残っている状態）
3. **時間帯**: 朝日の後2時間以内、または夕日の前2時間以内
4. **最近の天気**: 予報データから直近6時間以内に雨があったかチェック

※ これらはあくまで目安であり、実際に虹が見えることを保証するものではありません

---

## 🔧 トラブルシューティング

### 「OPEN_WEATHER_MAP_API_KEY が設定されていません」エラー

環境変数が正しく設定されていません。上記の「環境変数の設定」を参照してください。

### 位置情報が取得できない

- ブラウザの位置情報設定を確認してください
- HTTPSまたはlocalhostでアクセスしているか確認してください
- ブラウザによっては位置情報が制限されている場合があります

### 通知が来ない

- ブラウザの通知設定を確認してください
- 「通知を有効にする」ボタンで許可したか確認してください
- 実際に虹が出る条件を満たしていない可能性があります

---

## 📊 DB設計

データベースに保存する要素は無いシンプルなアプリケーションです。  
全ての処理はAPI連携とブラウザのストレージで完結します。

---

## 🔐 セキュリティについて

- APIキーは必ず環境変数で管理してください
- `.env`ファイルは`.gitignore`に含まれています（Gitにコミットされません）
- 本番環境ではHTTPSを使用してください
- 位置情報はセッションストレージに一時保存され、サーバーには保存されません

---

## 📱 ブラウザサポート

- Chrome 50+
- Firefox 44+
- Safari 10+
- Edge 14+

※ プッシュ通知機能はブラウザによって動作が異なる場合があります

---

## 🤝 貢献

プルリクエストを歓迎します！

1. このリポジトリをフォーク
2. 新しいブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

---

## 📄 ライセンス

なし

---

## 📮 お問い合わせ

Issue または Pull Request でお気軽にどうぞ！

---

**虹を見逃さないために - RainBow 🌈**
